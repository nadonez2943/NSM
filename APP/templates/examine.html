<doctype html>
  {% extends 'layout.html' %}
  
  {% block body %}
  <head>
  <style>
  </style>
  </head>
      
  <div class="row">
    <p>
      <br><h1>ตรวจรับโครงการ</h1>
      <div class="card-group">
        <div class="card">
          <div class="card-header">
            <center><h5>สถานะ</h5> </center>
          </div>
          <div class="card-body" align="center">
            
            <progress id="file" value="{{row[0]['stex_percent']}}" max="100"></progress>    
            <br><br>
            <label  id="sh" for="file">{{row[0]['stex_name']}}</label>
            <br>
            <p id="sD"></p>
            <p id="shw"></p>
            <p id="mess"></p>
            <form action="/project/{{row[0]['pj_id']}}/examinex" method="post">
              <input name="std" id="stex" value="{{row[0]['stex_id']}}" type="hidden">
              <input name="PMC" id="pop" value="{{row[0]['exPMcheck']}}" type="hidden">
              <div align="center"><input type="hidden" id="appbotton" onclick="return confirm('ยืนยัน')" value="ยืนยัน" ></form></div>
              <input name="userrole" id="userrole1" value="{{role['role']}}" type="hidden">
              {% for row in one %}
              <input name="sd1" id="sd1" value="{{row['daten']}}" type="hidden">
              {% endfor %}
              {% for row in two %}
              <input name="sd2" id="sd2" value="{{row['daten']}}" type="hidden">
              {% endfor %}
              {% for row in three %}
              <input name="sd3" id="sd3" value="{{row['daten']}}" type="hidden">
              {% endfor %}
          </div>
        </div>
        <p></p>
        <div class="card" id="divd" style="margin-left:5px;">
          <div class="card-header" align="center">
            <h5>การตรวจงาน</h5>
          </div>
          <div class="card-body">
            <div class="newspaper">
              {% for row in dis %}
              <a>งวดที่ :</a>
              <a id="c1">{{row['ins_no']}}</a><br>
              <a>ประจำวันที่ :</a><br>
              <a id="c2">{{row['checkdate']}}</a><br>
              <a>รายละเอียด :</a><br>
              <a id="c3">{{row['check_detail']}}</a><br>
              <a>ยอดเบิกจ่าย :</a>
              <a id="c4">{{row['ins_amount']}}</a><br>
              <a>%การเบิกจ่าย :</a><br>
              <a id="c5">{{row['ff']}} %</a><br>
                {% endfor %}
          </div> 
          <input id="conttid" value="{{dis[0]['ins_no']}} " type="hidden">
          <p align="right"><a href="/project/{{id}}/check" id="addcontt">เพิ่ม</a><a href="/editcheck/{{id}}" id="editcontt"> แก้ไข</a></p> 
      </div>
        </div>
      </div>
    </p>
      <div class="leftcolumn">
        <div class="card">
          <div class="card-body">
            <h5>รายละเอียดโครงการ</h5><hr>
              <div class="row">
                <div class="col-25">
                  <label>เลขสารบัญ</label>
                </div>
                <div class="col-75">
                  <label>{{row[0]['pj_refNumber']}}</label>
                </div>
              </div>
              <div class="row">
                <div class="col-25">
                  <label>ชื่อโครงการ</label>
                </div>
                <div class="col-75">
                  <label>{{row[0]['pj_name']}}</label>
                </div>
              </div>
              <div class="row">
                <div class="col-25">
                  <label>ผู้รับผิดชอบโครงการ</label>
                </div>
                <div class="col-75">
                  <label>{{rows[0]['user_fullname']}}</label>
                </div>
              </div>
              <div class="row">
                <div class="col-25">
                  <label>คณะกรรมการ</label>
                </div>
                <div class="col-75">
                  {% for result in row %}
                  <div class="row">
                    <div class="col-50">
                      <label id="fname">{{result['user_fullname']}}</label>
                    </div>
                    <div class="col-25">
                      <label  id="rname">{{result['role_name']}}</label>
                    </div>
                  </div>
                  <input id="user" value="{{row['user_fullname']}}" type="hidden">
                  {% endfor %}
                  <p align="right"><a href="addboarde" id="bea">เพิ่ม</a><a href="addboarde" id="bee"> แก้ไข</a></p>
                </div>
              </div>
              <div class="row">
                <div class="col-25">
                  <label>รายละเอียดโครงการ</label>
                </div>
                <div class="col-75">
                  <label>{{row[0]['pj_detail']}} บาท</label>
                </div>
              </div>
              <div class="row">
                <div class="col-25">
                  <label>งบประมาณ</label>
                </div>
                <div class="col-75">
                  <label>{{row[0]['pj_financeAmount']}} บาท</label>
                </div>
              </div>
        </div>
       </div>
        <div class="card" style="margin-top: 8px;">
          <div class="card-body">
            <h5>ข้อมูลบริษัท</h5><hr>
            <div class="row">
              <div class="col-25">
                <label>บริษัทผู้รับเหมา</label>
              </div>
              <div class="col-75">
                <label>{{row[0]['contt_name']}}</label>
              </div>
            </div><div class="row">
              <div class="col-25">
                <label>อีเมล</label>
              </div>
              <div class="col-75">
                <label>{{row[0]['contt_email']}}</label>
              </div>
            </div><div class="row">
              <div class="col-25">
                <label>เบอร์โทรศัพท์</label>
              </div>
              <div class="col-75">
                <label>{{row[0]['contt_tel']}}</label>
              </div>
            </div><div class="row">
              <div class="col-25">
                <label>วันที่ประกาศผล</label>
              </div>
              <div class="col-75">
                <label>{{row[0]['conttdate']}}</label>
              </div>
            </div><div class="row">
              <div class="col-25">
                <label>วงเงิน</label>
              </div>
              <div class="col-75">
                <label>{{row[0]['contt_fin']}} บาท</label>
              </div>
            </div>
          </div>
        </div>
      </div>
      
  
      <div class="rightcolumn" style="background-color:#ffffff;">
        <div class="card">
          <div class="card-header" align="center">
            <h5>การนัดหมาย</h5>
          </div>
          <div class="card-body" align="center">
            <p id="evn">{{ev[0]['ev_name']}}</p>
            <p id="evd">วันที่ {{ev[0]['evdate']}}</p>
            <p id="evt">เวลา {{ev[0]['evtime']}} น.</p>
            <a align="right" href="examineEvent">ดูเพิ่มเติม</a>
          </div>  
        </div>
        <div class="card" style="margin-top: 5px;">
          <div class="card-body">
            <a align="center" href="doc/3">เอกสารโครงการ</a>
          </div>
        </div>
      </div>

  </div>
  <br>
  <a class="btn btn-primary btn-lg" type="button" href="/project/{{row[0]['pj_id']}}">ย้อนกลับ</a>


<script>
  var c1 = document.getElementById("c1").innerHTML;
  var c2 = document.getElementById("c2").innerHTML;
  var c3 = document.getElementById("c3").innerHTML;
  var c4 = document.getElementById("c4").innerHTML;
  var c5 = document.getElementById("c5").innerHTML;
  if (c1 == "None"){
    document.getElementById("c1").innerHTML = "-";
    document.getElementById("c2").innerHTML = "-";
    document.getElementById("c3").innerHTML = "-";
    document.getElementById("c4").innerHTML = "-";
    document.getElementById("c5").innerHTML = "-";

  }
</script>

<script>
  var fname = document.getElementById("fname").innerHTML;
  var rname = document.getElementById("rname").innerHTML;
  if (fname == "None" && rname == "None" ){
    document.getElementById("fname").innerHTML = "-";
    document.getElementById("rname").innerHTML = "-";
  }
</script>

<script>
  var pd = document.getElementById("pd").innerHTML;
  if(pd = 'none'){
    document.getElementById("pd").innerHTML = "-";}
</script>


<script>
  var stdd = document.getElementById('stex').value;
  var usrole = document.getElementById('userrole1').value;
  var pmc = document.getElementById('pop').value;

  if (stdd == "3" && pmc != "wait" && pmc != "prewait" && usrole == "assistant")  {
    document.getElementById('appbotton').type = "submit";
    document.getElementById('pop').value = 'wait';
    document.getElementById('mess').innerHTML  = "ส่งงวดที่1ให้ managerตรวจ";
}
  if (stdd == "3" && pmc == "wait" && usrole == "assistant")  {
    document.getElementById('shw').innerHTML  = "manager: กำลังตรวจสอบการเบิกจ่าย";
  }
  if (stdd == "3" && pmc == "wait" && usrole == "manager")  {
    document.getElementById('appbotton').type = "submit";
    document.getElementById('pop').value = 'yes';
    document.getElementById('stex').value = '4';
    document.getElementById('appbotton').innerHTML  = "อนุมัติ";
    document.getElementById('shw').innerHTML  = "ตรวจสอบการเบิกจ่ายงวดที่1";
  }
  if (stdd == "4" && pmc == "yes" && usrole == "assistant")  {
    document.getElementById('appbotton').type = "submit";
    document.getElementById('pop').value = 'wait';
    document.getElementById('mess').innerHTML  = "ส่งงวดที่2ให้ managerตรวจ";
  }
  if (stdd == "4" && pmc == "wait" && usrole == "assistant")  {
    document.getElementById('shw').innerHTML  = "manager: กำลังตรวจสอบการเบิกจ่าย";
  }
  if (stdd == "4" && pmc == "wait" && usrole == "manager")  {
    document.getElementById('appbotton').type = "submit";
    document.getElementById('pop').value = 'yes';
    document.getElementById('stex').value = '5';
    document.getElementById('appbotton').innerHTML  = "อนุมัติ";
    document.getElementById('shw').innerHTML  = "ตรวจสอบการเบิกจ่ายงวดที่2";
  }
  if (stdd == "5" && pmc == "yes" && usrole == "assistant")  {
    document.getElementById('appbotton').type = "submit";
    document.getElementById('pop').value = 'wait';
    document.getElementById('mess').innerHTML  = "ส่งงวดที่3ให้ managerตรวจ";
  }
  if (stdd == "5" && pmc == "wait" && usrole == "assistant")  {
    document.getElementById('shw').innerHTML  = "กำลังตรวจสอบการเบิกจ่าย";
  }
  if (stdd == "5" && pmc == "wait" && usrole == "manager")  {
    document.getElementById('appbotton').type = "submit";
    document.getElementById('pop').value = 'yes';
    document.getElementById('stex').value = '6';
    document.getElementById('appbotton').innerHTML  = "อนุมัติ";
    document.getElementById('shw').innerHTML  = "ตรวจสอบการเบิกจ่ายงวดที่3";
  }
</script>  

  <script>
    var stex = document.getElementById('stex').value;
    var userrole = document.getElementById('userrole1').value;
    if (stex != "1"  && userrole == "manager") {
    document.getElementById('bea').style.display= "none";
    document.getElementById('bee').style.display= "none";
    }
    else if (stex == "2" && stex != "1" &&  userrole == "assistant"){
    document.getElementById('bee').style.display= "block";
    document.getElementById('bea').style.display= "none";
    }
    else if (stex == "1"  && userrole == "manager"){
    document.getElementById('bee').style.display= "none";
    document.getElementById('bea').style.display= "block";
   }
   else{
    document.getElementById('bea').style.display= "none";
    document.getElementById('bee').style.display= "none";
   }
    
  

    
    </script> 

  <script>
    var userrole = document.getElementById('userrole1').value;
    var stex = document.getElementById('stex').value;
    if (userrole == "manager") {
    document.getElementById('ea').style.display= "none";
    }
    else if (userrole == "assistant" && stex == 2 || stex == 1 ){
    document.getElementById('ea').style.display= "block";
    }
    else{
    document.getElementById('ea').style.display= "none";
    }
  </script> 
 
 
 <script>
      var sd1 = Number(document.getElementById("sd1").value);
      var sd2 = Number(document.getElementById("sd2").value);
      var sd3 = Number(document.getElementById("sd3").value);
      var stex = Number(document.getElementById("stex").value);
      if(sd1 == 7 && stex == 3){
        document.getElementById('sD').innerHTML  = "เหลือเวลา 7 วัน";
        }
      else if(sd2 == 7 && stex == 3){
        document.getElementById('sD').innerHTML  = "เหลือเวลา 7 วัน";
      }
      else if(sd3 == 7 && stex == 3){
        document.getElementById('sD').innerHTML  = "เหลือเวลา 7 วัน";
      }
      else if(sd1 == 3 && stex == 4 ){
        document.getElementById('sD').innerHTML  = "เหลือเวลา 3 วัน";
        }
      else if(sd2 == 3 && stex == 4 ){
        document.getElementById('sD').innerHTML  = "เหลือเวลา 3 วัน";
      }
      else if(sd3 == 3 && stex == 4 ){
        document.getElementById('sD').innerHTML  = "เหลือเวลา 3 วัน";
      }
      if(sd1 <0 && stex == 3 ){
        document.getElementById('sD').innerHTML  = "เลยชำระงวดที่1";
        document.getElementById('sD').innerHTML  = Math.abs(sd1)
        }
      else if(sd2 <0 && stex == 4 ){
        document.getElementById('sD').innerHTML  = "เลยชำระงวดที่2";
      }
      else if(sd3 <0 && stex == 5){
        document.getElementById('sD').innerHTML  = "เลยชำระงวดที่3";
      }
      if(sd1 == 0 && stex == 3 ){
        document.getElementById('sD').innerHTML  = "ส่งงวดที่1วันสุดท้าย";
        }
      else if(sd2 == 0 && stex == 4 ){
        document.getElementById('sD').innerHTML  = "ส่งงวดที่2วันสุดท้าย";
      }
      else if(sd3 == 0 && stex == 5){
        document.getElementById('sD').innerHTML  = "ส่งงวดที่3วันสุดท้าย";
      }
</script>   
<script>
  var cev1 = document.getElementById('cev1').value;
  if (cev1 == "none") {
    document.getElementById("cev1").innerHTML = "-";
    document.getElementById("cev2").innerHTML = "-";
    document.getElementById("cev3").innerHTML = "-";
  }
</script>

  {% endblock %}
