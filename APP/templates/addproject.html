<doctype html>
   {% extends 'layout.html' %}
   {% block body %}
   <br>
   <a class="btn btn-primary btn-lg" type="submit" href="/home" value="ย้อนกลับ">ย้อนกลับ</a>
   <br>
   <br>
   <div class="jumbotron">
   <center><h1>โครงการใหม่</h1></center>
   <hr>
   <form id="form" action="/addProject" method="post">
      <br>         
      <dl>
      <p>
         เลขสรรบัญ: <input name="refNumber" id="ref" value="" type="text" style="width:100px; " placeholder="เลขสรรบัญ" autocomplete="off" required> 
      </p>
      <p>
        
        
            <div class="row">
                <div class="col-md-6">
                     สำนักงาน
                     <select name="ofid"  id="ofid" class="form-control" title="Select office"> 
                     <option value=""></option>
                        {% for row in office %}
                            <option value="{{row.of_id}}">{{row.of_name}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                     กอง
                     <select name="dvid"  id="dv_name" class="form-control" title="Select division">
                  </select>
                </div>
            </div>
        </p>
      <p>
         ชื่อโครงการ: <input name="name" value="" type="text" style="width:814px;" placeholder="ชื่อโครงการ" autocomplete="off" required> 
      </p>
      <p>ประเภทโครงการ 
         <a class="container">&nbsp;&nbsp;&nbsp;
            <input type="radio" checked="checked" name="radio"  value="จัดซื้อ"> จัดซื้อ
            <span class="checkmark"></span>
         </a>&nbsp;&nbsp;&nbsp;
         <a class="container">
            <input type="radio" name="radio" value="จัดจ้าง">จัดจ้าง
            <span class="checkmark"></span>
         </a>&nbsp;&nbsp;&nbsp;&nbsp;
         งบประมาณ:
         <input name="amount" value="" id="num1" oninput="this.value = this.value.replace(/[^0-9.]/g, ''); this.value = this.value.replace(/(\..*)\./g, '$1');" class="mask" type="text" style="width:300px;"placeholder="งบประมาณ" autocomplete="off" required>
      </p>
      <p>
         รายละเอียดโครงการ
      </p> 
      <p> 
         <input name="detail" value="" type="text" style="width:900px; height: 88;  " placeholder="รายละเอียด " autocomplete="off" required> 
      </p>
      <p>
         วงเงิน:<input name="financeAmount" value="" class="mask" id="num2" oninput="this.value = this.value.replace(/[^0-9.]/g, ''); this.value = this.value.replace(/(\..*)\./g, '$1'); " type="text" style="width:170px; " title="วงเงินต้องน้อยกว่างบประมาณ" placeholder="วงเงิน "  autocomplete="off" required>&nbsp;บาท&nbsp;&nbsp; &nbsp;
         โดยใช้งบประมาณ:
         <select name="budgetSource" style="border: 2px solid black;"required>
            <option value="" disabled selected>ที่มางบประมาณ</option>
            <option value="ลงทุน">ลงทุน</option>
            <option value="ดำเนินการ">ดำเนินการ</option>
         </select>
         ประจำปีงบประมาณ:
         <select name="budgetYears" style="border: 2px solid black;" required>
            <option value="" disabled selected>ปีงบประมาณ</option>
            <option value="{{office[0]['curyear-2']}}">{{office[0]['curyear2']}}</option>
            <option value="{{office[0]['curyear-1']}}">{{office[0]['curyear1']}}</option>
            <option value="{{office[0]['curyear']}}">{{office[0]['curyear']}}</option>
            <option value="{{office[0]['curyear11']}}">{{office[0]['curyear11']}}</option>
            <option value="{{office[0]['curyear22']}}">{{office[0]['curyear22']}}</option>
          </select>
      </p>
      
      <br>
      <br>
      <br>
      <CENTER>
      <p>
         <input type="submit" class="btn" value="เพิ่มโครงการ">
      </p>
      </CENTER>
      </dl>
   </div>   
</form>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js">
</script>
<script>
   $(document).ready(function () {
      function load_data(type, category_id) {
      $.ajax({
      url: "/division",
      method: "POST",
      data: { type: type, category_id: category_id },
      dataType: "json",
      success: function (data) {
         var html = "";
         for (var count = 0; count < data.length; count++) {
            html += '<option value="' + data[count].id + '">' + data[count].name + "</option>";

         }
         if (type == "ofid") {
            $("#ofid").html(html);
            $("#ofid").selectpicker("refresh");
         } else {
            $("#dv_name").html(html);
            
         }
         },
      });
   }

   $(document).on("change", "#ofid", function () {
      var category_id = $("#ofid").val();
      load_data("dvid", category_id);
   });
});

    
</script>

<script>
$("input.mask").each((i,ele)=>{
    let clone=$(ele).clone(false)
    clone.attr("type","text")
    let ele1=$(ele)
    clone.val(Number(ele1.val()).toLocaleString("en"))
    $(ele).after(clone)
    $(ele).hide()
    clone.mouseenter(()=>{

      ele1.show()
      clone.hide()
    })
    setInterval(()=>{
      let newv=Number(ele1.val()).toLocaleString("en")
      if(clone.val()!=newv){
        clone.val(newv)
      }
    },10)

    $(ele).mouseleave(()=>{
      $(clone).show()
      $(ele1).hide()
    })
    

  })
</script>
<script>
document.getElementById("num1").oninput = function() {checkValues()};
document.getElementById("num2").oninput = function() {checkValues()};
function checkValues() {
   var num1 = Number(document.getElementById('num1').value);
   var num2 = Number(document.getElementById('num2').value);
        if (num2 > num1) {
            alert("วงเงินต้องน้อยกว่างบประมาณ");
            document.getElementById('num2').value= num1 ;
        }
    }
</script>
{% endblock %}